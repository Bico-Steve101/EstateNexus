{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>EstateNexus - The Property Manager</title>
    <!-- Simple bar CSS -->
    <link rel="stylesheet" href="{% static 'dark/css/simplebar.css' %}">
    <!-- Fonts CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Overpass:ital,wght@0,100;0,200;0,300;0,400;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <!-- Icons CSS -->
    <link rel="stylesheet" href="{% static 'dark/css/feather.css' %}">
    <!-- Date Range Picker CSS -->
    <link rel="stylesheet" href="{% static 'dark/css/daterangepicker.css' %}">
    <!-- App CSS -->
    <link rel="stylesheet" href="{% static 'dark/css/app-light.css' %}" id="lightTheme" disabled>
    <link rel="stylesheet" href="{% static 'dark/css/app-dark.css' %}" id="darkTheme">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://unpkg.com/intasend-inlinejs-sdk@4.0.0/build/intasend-inline.js"></script>
  </head>
  <body class="vertical  dark  ">
    <div class="wrapper">
      <nav class="topnav navbar navbar-light">
        <button type="button" class="navbar-toggler text-muted mt-2 p-0 mr-3 collapseSidebar">
          <i class="fe fe-menu navbar-toggler-icon"></i>
        </button>
        <form class="form-inline mr-auto searchform text-muted">
          <input class="form-control mr-sm-2 bg-transparent border-0 pl-4 text-muted" type="search" placeholder="Type something..." aria-label="Search">
        </form>
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link text-muted my-2" href="#" id="modeSwitcher" data-mode="dark">
              <i class="fe fe-sun fe-16"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-muted my-2" href="./#" data-toggle="modal" data-target=".modal-shortcut">
              <span class="fe fe-grid fe-16"></span>
            </a>
          </li>
          <li class="nav-item nav-notif">
            <a class="nav-link text-muted my-2" href="./#" data-toggle="modal" data-target=".modal-notif">
              <span class="fe fe-bell fe-16"></span>
              <span class="dot dot-md bg-success"></span>
            </a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle text-muted pr-0" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="avatar avatar-sm mt-2">
                <img src="{% static 'dark/assets/avatars/face-1.jpg' %}" alt="..." class="avatar-img rounded-circle">
              </span>
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
              <a class="dropdown-item" href="#">Profile</a>
              <a class="dropdown-item" href="#">Settings</a>
              <a class="dropdown-item" href="#">Activities</a>
            </div>
          </li>
        </ul>
      </nav>
      <aside class="sidebar-left border-right bg-white shadow" id="leftSidebar" data-simplebar>
        <a href="#" class="btn collapseSidebar toggle-btn d-lg-none text-muted ml-2 mt-3" data-toggle="toggle">
          <i class="fe fe-x"><span class="sr-only"></span></i>
        </a>
        <nav class="vertnav navbar navbar-light">
          <!-- nav bar -->
          <div class="w-100 mb-4 d-flex">
            <a class="navbar-brand mx-auto mt-2 flex-fill text-center" href="{% url 'User:dashboard' %}">
              <img src="{% static 'dark/images/home (2).png' %}" alt="estatenexus">
            </a>
          </div>
          <ul class="navbar-nav flex-fill w-100 mb-2">
            <li class="nav-item dropdown">
              <a href="#dashboard" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle nav-link">
                <i class="fe fe-pie-chart fe-16"></i>
                <span class="ml-3 item-text">Dashboard</span><span class="sr-only">(current)</span>
              </a>
              <ul class="collapse list-unstyled pl-4 w-100" id="dashboard">
                <li class="nav-item active">
                  <a class="nav-link pl-3" href="{% url 'User:dashboard' %}"><span class="ml-1 item-text">Main</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link pl-3" href="{% url 'User:dashboard-sales' %}"><span class="ml-1 item-text">E-commerce</span></a>
                </li>
              </ul>
            </li>
          </ul>
          <p class="text-muted nav-heading mt-4 mb-1">
            <span>Details</span>
          </p>
          <ul class="navbar-nav flex-fill w-100 mb-2">
{#            <li class="nav-item dropdown">#}
{#              <a href="{% url 'User:payments' %}" aria-expanded="false" class="nav-link">#}
{#                <i class="fe fe-dollar-sign fe-16"></i>#}
{#                <span class="ml-3 item-text">Payments</span>#}
{#                <span class="badge badge-pill badge-primary text-center mt-1">New</span>#}
{#              </a>#}
{#            </li>#}
            <li class="nav-item dropdown">
              <a href="{% url 'User:managers' %}" aria-expanded="false" class="nav-link">
                <i class="fe fe-users fe-16"></i>
                <span class="ml-3 item-text">Managers</span>
              </a>
            </li>
            <li class="nav-item dropdown">
              <a href="{% url 'User:properties' %}" aria-expanded="false" class="nav-link">
                <i class="fe fe-home fe-16"></i>
                <span class="ml-3 item-text">Properties</span>
              </a>
            </li>
          </ul>
          <p class="text-muted nav-heading mt-4 mb-1">
            <span>Apps</span>
          </p>
          <ul class="navbar-nav flex-fill w-100 mb-2">
            <li class="nav-item w-100">
              <a class="nav-link" href="{% url 'User:calendar' %}">
                <i class="fe fe-calendar fe-16"></i>
                <span class="ml-3 item-text">Calendar</span>
              </a>
            </li>
          </ul>
          <p class="text-muted nav-heading mt-4 mb-1">
            <span>Documentation</span>
          </p>
          <ul class="navbar-nav flex-fill w-100 mb-2">
            <li class="nav-item w-100">
              <a class="nav-link" href="{% url 'User:getting-started' %}">
                <i class="fe fe-help-circle fe-16"></i>
                <span class="ml-3 item-text">Getting Start</span>
              </a>
            </li>
          </ul>
          <div class="btn-box w-100 mt-5 mb-1">
            <a href="{% url 'User:logout' %}" target="_blank" class="btn mb-2 btn-primary btn-lg btn-block">
              <i class="fe fe-power fe-12 mx-2"></i><span class="small">LogOut</span>
            </a>
          </div>
        </nav>
      </aside>
      <main role="main" class="main-content">
        <div class="container-fluid">
          <div class="row justify-content-center">
            <div class="col-12">
              <!-- <h2>Section Property</h2> -->
                            {% if messages %}
                <div class="col-12 mb-4">
                  <div class="alert alert-success alert-dismissible fade show" role="alert">
                          {% for message in messages %}
                    <strong>{{ tenant.first_name }} {{ tenant.last_name }}</strong> {{ message }}<button type="button" class="close" data-dismiss="alert" aria-label="Close">
                         {% endfor %}
                      <span aria-hidden="true">×</span>
                    </button>
                  </div>
                </div>
                            {% endif %}
              <div class="row">
                <div class="col-md-12 mb-4">
                  <div class="card profile shadow">
                    <div class="card-body my-4">
                      <div class="row align-items-center">
                        <div class="col-md-3 text-center mb-5">
                          <a href="#{{ tenant.first_name }}" class="avatar avatar-xl">
                            <img src="{{ tenant.photo.url }}" alt="..." class="avatar-img rounded-circle" style="border-radius: 50%; height: 10em; width: 10em">
                          </a>
                        </div>
                        <div class="col">
                          <div class="row align-items-center">
                            <div class="col-md-7">
                              <h4 class="mb-1">{{ property_occupied.name }}</h4>
                              <p class="small mb-3"><span class="badge badge-dark">{{ property_occupied.county }}, {{ property_occupied.country }}</span></p>
                            </div>
                            <div class="col">
                            </div>
                          </div>
                          <div class="row mb-4">
                            <div class="col-md-7">
                              <p class="text-muted">
                                  {{ property_occupied.description }}
                              </p>
                            </div>
                            <div class="col">
                              <p class="small mb-0 text-muted">{{ tenant.first_name }} {{ tenant.last_name }}</p>
                              <p class="small mb-0 text-muted">{{ tenant.email }}</p>
                              <p class="small mb-0 text-muted">{{ tenant.phone_number }}</p>
                            </div>
                          </div>
                          <div class="row align-items-center">
                            <div class="col-md-7 mb-2">
                              <span class="small text-muted mb-0">Joined {{ tenant.joined|date:"F j, Y" }}</span>
                            </div>
                            <div class="col mb-2 d-flex">
                              <button type="button" class="btn btn-primary">Edit</button>
                              <button type="button" class="btn btn-primary ml-2" href="./#" data-toggle="modal" data-target=".modal-message"><i class="fe fe-message-circle mr-2"></i>Chat</button>
                              <a href="" onClick="window.location.href=window.location.href">
                                <div class="col-auto">
                                    <span class="circle circle-sm bg-light">
                                      <i class="fe fe-refresh-ccw"></i>
                                    </span>
                                  </div>
                                </a>
                            </div>
                          </div>
                        </div>
                      </div> <!-- / .row- -->
                    </div> <!-- / .card-body - -->
                  </div> <!-- / .card- -->
                </div> <!-- / .col- -->
              </div> <!-- end section -->
              <div class="row">
                <div class="col-md-6 col-xl-3 mb-4">
                  <div class="card shadow bg-primary text-white">
                    <div class="card-body">
                      <div class="row align-items-center">
                        <div class="col-3 text-center">
                          <span class="circle circle-sm bg-primary-light">
                            <i class="fe fe-16 fe-dollar-sign text-white mb-0"></i>
                          </span>
                        </div>
                        <div class="col pr-0">
                          <p class="small text-light mb-0">Monthly Rent</p>
                          <span class="h3 mb-0 text-white">${{ property_occupied.price }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 col-xl-3 mb-4 ">
                  <div class="card shadow bg-primary text-white" style="width: 18.5em">
                    <div class="card-body">
                      <div class="row align-items-center">
                        <div class="col-3 text-center">
                          <span class="circle circle-sm bg-primary-light">
                            <i class="fe fe-16 fe-user-check text-white mb-0"></i>
                          </span>
                        </div>
                        <div class="col pr-0">
                          <p class="small text-light mb-0">Paid</p>
                          <span class="h3 mb-0 text-white">{{ total_monthly_payments }}</span>
                          <span class="small text-success text-white">
                              {% if balance >= property_price  %}
                                <span class="text-success">{{ balance }}</span>
                            {% else %}
                                <span class="text-danger">{{ balance }}</span>
                            {% endif %}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 col-xl-3 mb-4">
                  <div class="card shadow ml-4" >
                    <div class="card-body">
                      <div class="row align-items-center">
                        <div class="col-3 text-center">
                          <span class="circle circle-sm bg-primary">
                            <i class="fe fe-16  fe-users text-white mb-0"></i>
                          </span>
                        </div>
                        <div class="col pr-0">
                          <p class="small text-muted mb-0">Tenant ID</p>
                          <span class="h3 mb-0">{{ tenant.tenant_id }}</span>
                          <span class="small text-success">H<span>{{ tenant.house_number }}</span></span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-4 col-xl-3 mb-4">
                  <div class="card shadow">
                    <div class="card-body">
                      <div class="row align-items-center">
                        <div class="col-3 text-center">
                          <span class="circle circle-sm bg-primary">
                            <i class="fe fe-16  fe-users text-white mb-0"></i>
                          </span>
                        </div>
                        <div class="col pr-0">
                            <div><button class="intaSendPayButton" data-amount="10" data-currency="KES" data-email="joe@doe.com" data-first_name="JOE" data-last_name="DOE" data-country="KE">Pay Now</button></div>
{#                          <button type="button" class="btn mb-2 btn-outline-secondary" data-toggle="modal" data-target="#varyModal" data-whatever="@mdo">Make Payment</button>#}
                        </div>
                      </div>
                        <div class="modal fade" id="varyModal" tabindex="-1" role="dialog" aria-labelledby="varyModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="varyModalLabel">Select Payment Method</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body ">
                                        <ul class=" row mb-1 ml-n3" id="pills-tab2" role="tablist">
                                            <li class="card shadow mr-2">
                                                <a class="card-body px-3 active" id="pills-home-tab2"  href="{% url 'User:mpesa_payment' %}"  aria-selected="true"><span class="fe fe-16 fe-smartphone mt-2 p-35"></span><span class="h5 mb-0"> M-pesa</span></a>
                                            </li>
                                            <li class="card shadow">
                                                <a class="card-body px-3" id="pills-profile-tab2"  href="{% url 'User:credit_card_payment' %}"  aria-selected="false"><span class="fe fe-16 fe-credit-card mt-2 p-35"></span><span class="h5 mb-0"> Credit Card</span></a>
                                            </li>
                                            <li class="card shadow ml-2">
                                                <a class="card-body px-4" id="pills-contact-tab2"  href="{% url 'User:paypal_payment' %}"   aria-selected="false"><span class="fe fe-16 fe-dollar-sign mt-2 p-35"></span><span class="h5 mb-0"> Paypal</span></a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn mb-2 btn-secondary" data-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                  </div>
                </div>
              </div> <!-- end section -->
            </div>
          </div> <!-- .row -->
        </div> <!-- .container-fluid -->
        <div class="modal fade modal-notif modal-slide" tabindex="-1" role="dialog"  aria-labelledby="defaultModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="defaultModalLabel">Notifications</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <div class="list-group list-group-flush my-n3">
                  <div class="list-group-item bg-transparent">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <span class="fe fe-box fe-24"></span>
                      </div>
                      <div class="col">
                        <small><strong>Package has uploaded successfull</strong></small>
                        <div class="my-0 text-muted small">Package is zipped and uploaded</div>
                        <small class="badge badge-pill badge-light text-muted">1m ago</small>
                      </div>
                    </div>
                  </div>
                  <div class="list-group-item bg-transparent">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <span class="fe fe-download fe-24"></span>
                      </div>
                      <div class="col">
                        <small><strong>Widgets are updated successfull</strong></small>
                        <div class="my-0 text-muted small">Just create new layout Index, form, table</div>
                        <small class="badge badge-pill badge-light text-muted">2m ago</small>
                      </div>
                    </div>
                  </div>
                  <div class="list-group-item bg-transparent">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <span class="fe fe-inbox fe-24"></span>
                      </div>
                      <div class="col">
                        <small><strong>Notifications have been sent</strong></small>
                        <div class="my-0 text-muted small">Fusce dapibus, tellus ac cursus commodo</div>
                        <small class="badge badge-pill badge-light text-muted">30m ago</small>
                      </div>
                    </div> <!-- / .row -->
                  </div>
                  <div class="list-group-item bg-transparent">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <span class="fe fe-link fe-24"></span>
                      </div>
                      <div class="col">
                        <small><strong>Link was attached to menu</strong></small>
                        <div class="my-0 text-muted small">New layout has been attached to the menu</div>
                        <small class="badge badge-pill badge-light text-muted">1h ago</small>
                      </div>
                    </div>
                  </div> <!-- / .row -->
                </div> <!-- / .list-group -->
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-block" data-dismiss="modal">Clear All</button>
              </div>
            </div>
          </div>
        </div>
        <div class="modal fade modal-shortcut modal-slide" tabindex="-1" role="dialog" aria-labelledby="defaultModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="defaultModalLabel">Shortcuts</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body px-5">
                <div class="row align-items-center">
                  <div class="col-6 text-center">
                    <div class="squircle bg-success justify-content-center">
                      <i class="fe fe-cpu fe-32 align-self-center text-white"></i>
                    </div>
                    <p>Control area</p>
                  </div>
                  <div class="col-6 text-center">
                    <div class="squircle bg-primary justify-content-center">
                      <i class="fe fe-activity fe-32 align-self-center text-white"></i>
                    </div>
                    <p>Activity</p>
                  </div>
                </div>
                <div class="row align-items-center">
                  <div class="col-6 text-center">
                    <div class="squircle bg-primary justify-content-center">
                      <i class="fe fe-droplet fe-32 align-self-center text-white"></i>
                    </div>
                    <p>Droplet</p>
                  </div>
                  <div class="col-6 text-center">
                    <div class="squircle bg-primary justify-content-center">
                      <i class="fe fe-upload-cloud fe-32 align-self-center text-white"></i>
                    </div>
                    <p>Upload</p>
                  </div>
                </div>
                <div class="row align-items-center">
                  <div class="col-6 text-center">
                    <div class="squircle bg-primary justify-content-center">
                      <i class="fe fe-users fe-32 align-self-center text-white"></i>
                    </div>
                    <p>Users</p>
                  </div>
                  <div class="col-6 text-center">
                    <div class="squircle bg-primary justify-content-center">
                      <i class="fe fe-settings fe-32 align-self-center text-white"></i>
                    </div>
                    <p>Settings</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Modal message start -->
        <div class="modal fade modal-message modal-slide" tabindex="-1" role="dialog" aria-labelledby="defaultModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="defaultModalLabel">Messages</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">×</span>
                </button>
              </div>
              <div class="modal-body">
                <div class="list-group list-group-flush my-n3 " style="position: relative; height: 100%">
                  <div class="card-body overflow-auto" data-mdb-perfect-scrollbar="true" style="position: relative; height: 460px; overflow: auto;" id="chat-messages">
                    <!-- Messages will be appended here -->
                    <div id="messages">
                       {% for message in messages %}
                            <div class="message {% if message.sender == user %}sent{% else %}received{% endif %}">
                                <small>
                                    {% if message.sender == user %}
                                        <div class="d-flex justify-content-end">
                                        <p class="small mb-1 text-muted">{{ message.timestamp|date:"j M" }} {{ message.timestamp|time:"g:i A" }}</p>
                                        <p class="small mb-1">{{ user.first_name }} {{ user.last_name }}</p>
                                      </div>
                                      <div class="d-flex flex-row justify-content-end mb-4 pt-1">
                                        <div>
                                          <p class="small p-2 me-3 mb-3 text-white rounded-3 bg-warning card">{{ message.content }}</p>
                                            {% if message.is_received %}<p class="small">Received</p>{% endif %}
                                            {% if message.is_read %}<p class="small">Read</p>{% endif %}
                                        </div>
                                        <img src="{{ user.avatar.url }}"
                                          alt="avatar 1" style="border-radius: 50%; height: 3em; width: 3em">
                                      </div>
                                    {% else %}
                                        <div class="d-flex justify-content-start">
                                        <p class="small mb-1">{{ message.property.name }}</p>
                                        <p class="small mb-1 text-muted">{{ message.timestamp|date:"j M" }} {{ message.timestamp|time:"g:i A" }}</p>
                                      </div>
                                      <div class="d-flex flex-row justify-content-start">
                                        <img src="{{ message.property.photo.url }}"
                                          alt="avatar 1" class="mr-1" style="border-radius: 50%; height: 3em; width: 3em">
                                        <div>
                                          <p class="small p-2 ms-3 mb-3 rounded-3 card" style="background-color: #f5f6f7;">{{ message.content }}</p>
                                            {% if message.is_received %}<p class="small">Received</p>{% endif %}
                                            {% if message.is_read %}<p class="small">Read</p>{% endif %}
                                        </div>
                                      </div>
                                    {% endif %}
                                </small>
                            </div>
                        {% endfor %}
                    </div>
                  </div>
                  <div class="modal-footer">
                      <form method="post" id="message-form">
                        {% csrf_token %}
                    <div class="input-group mb-0">
                      <textarea name="content" class="form-control bg-light scrollbar scrollbar-black bordered-black square thin" id="id_content" rows="2" style="resize: none;"></textarea>
                      <button class="btn btn-primary mt-2 ml-1" type="button" id="send-button" style="padding-top: .50rem; height: 3em;">
                        Send
                      </button>
                    </div>
                      </form>
                  </div>
                </div> <!-- / .list-group -->
              </div>
            </div>
          </div>
        </div>
        <!-- Modal message end -->

           <!-- .card -->
        <div class="card shadow mb-4">
            <div class="card-header">
              <strong class="card-title">Tenant Reviews</strong>
              <span class="float-right"><i class="fe fe-message-circle mr-2"></i>4</span>
            </div>
            <div class="card-body ">
              <div class="swipe">
              <div class="row align-items-center mb-4">
                <div class="col-auto">
                  <div class="avatar avatar-sm mb-3 mx-4">
                    <img src="{% static 'dark/assets/avatars/face-3.jpg' %}" alt="..." class="avatar-img rounded-circle">
                  </div>
                </div>
                <div class="col">
                  <strong>Hester Nissim</strong> <span>Hse24</span>
                  <div class="mb-2">Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</div>
                  <div class="card mb-3 bg-light w-50">
                    <div class="row no-gutters align-items-center">
                      <div class="col-md-2 text-center">
                        <img src="{% static 'dark/assets/products/p1.jpg' %}" alt="..." class="img-fluid rounded m-1">
                      </div>
                      <div class="col-md-10">
                        <div class="card-body py-0">
                          <p class="card-title mb-0">New screenshot-12.png</p>
                          <div class="card-text my-0 text-muted small"><span class="mr-2">1.2M</span><span class="mr-2">SVG</span></div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <small class="text-muted">2020-04-21 08:48:18</small>
                </div>
                <div class="col-auto">
                  <span class="circle circle-sm bg-light toggle-col">
                    <i class="fe fe-corner-down-left"></i>
                  </span>
                </div>
              </div> <!-- .row-->
              <div class="row align-items-center mb-4">
                <div class="col-auto">
                  <div class="avatar avatar-sm mb-3 mx-4">
                    <img src="{% static 'dark/assets/avatars/face-4.jpg' %}" alt="..." class="avatar-img rounded-circle">
                  </div>
                </div>
                <div class="col">
                  <strong>Kelley Sonya</strong> <span>Hse45</span>
                  <div class="mb-2">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus sollicitudin luctus pretium. <br />Pellentesque porta massa ac nibh finibus iaculis. Maecenas vel interdum urna. Integer auctor ultrices faucibus. Aliquam consequat et ligula nec sodales.</div>
                  <small class="text-muted">2020-04-21 12:01:22</small>
                </div>
                <div class="col-auto">
                  <span class="circle circle-sm bg-light">
                    <i class="fe fe-corner-down-left toggle-col"></i>
                  </span>
                </div>
              </div> <!-- .row-->
              </div>
              <hr class="my-4">
              <h6 class="mb-3">Response</h6>
              <form>
                <div class="form-group">
                  <label for="exampleFormControlTextarea1" class="sr-only">Your Message</label>
                  <textarea class="form-control bg-light" id="exampleFormControlTextarea1" rows="2"></textarea>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                  <div class="form-check form-check-inline ml-1">
                    <input class="form-check-input" type="checkbox" id="inlineCheckbox1" value="option1">
                    <label class="form-check-label" for="inlineCheckbox1">Email Notification</label>
                  </div>
                  <div class="flex-fill mr-2 text-right">
                    <a href="#" class="btn"><i class="fe fe-upload"></i></a>
                  </div>
                  <button type="submit" class="btn btn-primary">Submit</button>
                </div>
              </form>
            </div> <!-- .card-body -->
        </div>
          <!-- .card -->

        <div class="row d-flex flex-row">
          <!-- Payments List Full -->
            <div class="col-md-8 mb-4">
                <div class="card shadow" style="max-height: 18.7em;">
                    <div class="card-header">
                        <strong class="card-title">Payments</strong>
                        <a class="float-right small text-muted" href="{% url 'User:invoice' %}">View all</a>
                    </div>
                    <div class="card-body" style="overflow: auto;">
                        <table class="table table-borderless my-n3">
                            <thead class="d-none">
                                <tr>
                                    <th>Mode</th>
                                    <th class="w-50">Amount</th>
                                    <th>Balance</th>
                                    <th>Date Time</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody style="max-height: 300px; overflow-y: auto; text-align: center;">
                                {% for payment in payments %}
                                <tr>
                                    <td><span class="text-muted">{{ payment.mode }}</span></td>
                                    <th scope="row">
                                        <small><strong>{{ payment.amount }}</strong></small><br />
                                        <span class="badge badge-light text-muted mr-2">
                                            {% if balance >= property_price  %}
                                                <span class="text-success">+{{ balance }}</span>
                                            {% else %}
                                                <span class="text-danger">{{ balance }}</span>
                                            {% endif %}</span>
                                    </th>
                                    <td>
                                        <small>{{ payment.payment_date|time }}</small><br />
                                        <small class="text-muted">{{ payment.payment_date|date }}</small>
                                    </td>
                                    <td>
                                        <div class="dropdown">
                                            <button class="btn btn-sm dropdown-toggle more-dropdown" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <span class="sr-only"></span>
                                            </button>
                                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                                                <a class="dropdown-item" href="#"><small>Mark</small></a>
                                                <a class="dropdown-item" href="{% url 'User:invoice' %}"><small>Download</small></a>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div> <!-- / .card-body -->
            </div> <!-- / .card -->
          <div class="col-md-4">
            <div class="card shadow mb-2">
              <div class="card-body">
                <div class="py-4 text-center">
                  <p class="text-muted mb-3">Total Payments</p>
                  <h2 class="mb-1">{{ total_all_time_payments }}</h2>
                  <span class="small text-success">+2%</span>
                </div>
                <div class="row align-items-center mb-1">
                  <div class="col-auto">
                    <div class="my-2 text-left">
                      <small class="text-danger mr-2">M-pesa</small>
                      <small class="text-warning mx-2">Credit-card</small>
                      <small class="text-success mx-2">Paypal</small>
                    </div>
                  </div>
                  <div class="col text-right">
                    <small class="mb-0 text-muted">Statistics</small>
                  </div>
                </div>
                <div class="progress rounded mb-3" style="height:14px">
                  <div class="progress-bar bg-danger" role="progressbar" style="width: {{ mpesa_percentage }}%" aria-valuenow="{{ mpesa_percentage|floatformat:0 }}" aria-valuemin="0" aria-valuemax="100">{{ mpesa_percentage|floatformat:0 }}%</div>
                  <div class="progress-bar bg-warning" role="progressbar" style="width: {{ credit_card_percentage }}%" aria-valuenow="{{ credit_card_percentage|floatformat:0 }}" aria-valuemin="0" aria-valuemax="100">{{ credit_card_percentage|floatformat:0 }}%</div>
                  <div class="progress-bar bg-success" role="progressbar" style="width: {{ credit_card_percentage }}%" aria-valuenow="{{ paypal_percentage|floatformat:0 }}" aria-valuemin="0" aria-valuemax="100">{{ paypal_percentage|floatformat:0 }}%</div>
                </div>
              </div> <!-- .card-body -->
            </div> <!-- .card -->
          </div>
        </div> <!-- end section -->
      </main> <!-- main -->

    </div> <!-- .wrapper -->
        <script>
        // setup chat socket
        const chatSocket = new WebSocket(
            'ws://' + window.location.host + '/ws/chat/' + '{{ room_name }}' + '/'
        );

        // on socket open
        chatSocket.onopen = function (e) {
            console.log('Chat socket successfully connected.');
        };

        // on socket close
        chatSocket.onclose = function (e) {
            console.log('Chat socket closed unexpectedly');
        };

        // on receiving message on group
        chatSocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            const message = data.message;
            const sender = data.sender;
            const receiver = data.receiver;
            setMessage(message, sender, receiver);
        };

        // sending the text message to server
        document.querySelector('#send-button').onclick = function(e) {
            const messageInputDom = document.querySelector('#id_content');
            const message = messageInputDom.value.trim();
            if (message) {
                chatSocket.send(JSON.stringify({
                    'message': message,
                    'sender': '{{ user.email }}',
                    'receiver': '{{ receiver.email }}'  // Replace with the actual receiver's email
                }));
                messageInputDom.value = '';
            }
        };

    function setMessage(message, sender, receiver) {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message';

        const isSender = sender === '{{ user.email }}';
        const name = isSender ? 'You' : '{{ user.first_name }} {{ user.last_name }}';
        const avatarUrl = isSender ? '{{ user.avatar.url }}' : '{{ message.property.photo.url }}';
        const alignmentClass = isSender ? 'justify-content-end' : 'justify-content-start';
        const bgColor = isSender ? '#DCF8C6' : '#EAEAEA';
        const textColor = isSender ? 'black' : 'black';

        const messageTime = new Date().toLocaleString('en-US', {
            hour: 'numeric',
            minute: 'numeric',
            hour12: true,
            day: 'numeric',
            month: 'short'
        });

        const nameAndTimeDiv = document.createElement('div');
        nameAndTimeDiv.className = 'd-flex flex-row ' + alignmentClass;

        const nameTag = document.createElement('p');
        nameTag.className = 'small mb-1';
    nameTag.textContent = name;

        const timeTag = document.createElement('p');
        timeTag.className = 'small mb-1 text-muted ms-2';
    timeTag.textContent = messageTime;

    nameAndTimeDiv.appendChild(nameTag);
    nameAndTimeDiv.appendChild(timeTag);

        const messageContentDiv = document.createElement('div');
        messageContentDiv.className = 'd-flex flex-row align-items-center';

        const messageContent = document.createElement('p');
        messageContent.className = 'small p-2 mb-3 rounded-3 card';
    messageContent.textContent = message;
    messageContent.style.backgroundColor = bgColor;
    messageContent.style.color = textColor;
    messageContent.style.maxWidth = '75%'; // Adjust as needed

        const avatarImg = document.createElement('img');
        avatarImg.src = avatarUrl;
    avatarImg.alt = 'Avatar';
    avatarImg.style.borderRadius = '50%';
    avatarImg.style.height = '3em';
    avatarImg.style.width = '3em';
    avatarImg.style.marginRight = isSender ? '1rem' : '0'; // Adjust margin for avatar
    avatarImg.style.marginLeft = isSender ? '0' : '1rem'; // Adjust margin for avatar

    if (isSender) {
        messageContentDiv.appendChild(messageContent);
        messageContentDiv.appendChild(avatarImg);
        messageContentDiv.style.justifyContent = 'flex-end';
    } else {
        messageContentDiv.appendChild(avatarImg);
        messageContentDiv.appendChild(messageContent);
    }

    messageDiv.appendChild(nameAndTimeDiv);
    messageDiv.appendChild(messageContentDiv);

    document.getElementById('messages').appendChild(messageDiv);
    }


                $('#modal-message').on('show.bs.modal', function (e) {
            $.post('/mark_all_messages_as_read/', function(data) {
                if (data.success) {
                    console.log('All messages marked as read');
                } else {
                    console.log('Failed to mark messages as read');
                }
            });
        });
    </script>
    <script>
  new window.IntaSend({
  // Replace with your Publishable Key
  publicAPIKey: "ISPubKey_test_47d6f29a-490e-4909-b22e-e77936373ade",
  live: false //set to true when going live
})
.on("COMPLETE", (results) => console.log("Do something on success", results))
.on("FAILED", (results) => console.log("Do something on failure", results))
.on("IN-PROGRESS", (results) => console.log("Payment in progress status", results))
    </script>
    <script src="{% static 'dark/js/jquery.min.js' %}"></script>
    <script src="{% static 'dark/js/popper.min.js' %}"></script>
    <script src="{% static 'dark/js/moment.min.js' %}"></script>
    <script src="{% static 'dark/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'dark/js/simplebar.min.js' %}"></script>
    <script src='{% static 'dark/js/daterangepicker.js' %}'></script>
    <script src='{% static 'dark/js/jquery.stickOnScroll.js' %}'></script>
    <script src="{% static 'dark/js/tinycolor-min.js' %}"></script>
    <script src="{% static 'dark/js/config.js' %}"></script>
    <script src="{% static 'dark/js/apps.js' %}"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-56159088-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];

      function gtag()
      {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', 'UA-56159088-1');
    </script>
  </body>
</html>